@{
    ViewData["Title"] = "Quick Register";
}

<link rel="stylesheet" href="~/css/pilot/quick-register.css" />

<div class="quick-register-container">
    <div id="quick-register-map"
         data-check-duplicates-url="@Url.Action("CheckDuplicates", "Pilot")"
         data-quick-register-url="@Url.Action("QuickRegister", "Pilot")"
         data-register-type-url="@Url.Action("RegisterType", "Pilot")"></div>
</div>

<div class="status-overlay" id="status-overlay">
    <div class="status-box">
        <div id="loading-state">
            <div class="icon">üìç</div>
            <h2>Getting Your Location</h2>
            <p>Please allow location access to quickly register this obstacle.</p>
            <div class="spinner"></div>
            <p style="font-size: 14px; color: #9ca3af;">This may take a few seconds...</p>
        </div>

        <div id="duplicate-state" class="hidden duplicate-popup">
            <h2>‚ö†Ô∏è Existing Obstacles Found!</h2>
            <p style="color: #6b7280; margin-bottom: 20px;">
                We found one or more obstacles already registered near this location.
                Please review them before continuing:
            </p>

            <div id="duplicate-list"></div>

            <p style="color: #374151; font-weight: 500; margin-top: 20px;">
                Are you sure you want to register a new obstacle here?
            </p>

            <div class="popup-buttons">
                <button class="btn-cancel" id="btn-cancel-registration">
                    ‚ùå Cancel
                </button>
                <button class="btn-continue" id="btn-continue-registration">
                    ‚úì Continue Anyway
                </button>
            </div>
        </div>

        <div id="success-state" class="hidden">
            <div class="icon success-icon">‚úì</div>
            <h2>Location Saved Successfully!</h2>
            <p>Your GPS location has been saved. You can complete the details later from My Registrations.</p>
            <p class="redirect-timer">Redirecting in <span id="countdown">3</span> seconds...</p>
            <div style="margin-top: 30px;">
                <a href="@Url.Action("RegisterType", "Pilot")" class="action-btn">Continue Now</a>
            </div>
        </div>

        <div id="error-state" class="hidden">
            <div class="icon error-icon">‚úó</div>
            <h2 class="error-text">Location Access Problem</h2>
            <p id="error-message">We couldn't get your location.</p>

            <div class="help-text">
                <strong>üí° Common Solutions:</strong>
                <ul>
                    <li><strong>Using IP address?</strong> Try <code>localhost</code> instead</li>
                    <li><strong>Check browser settings:</strong> Allow location for this site</li>
                    <li><strong>HTTPS required:</strong> Location only works on localhost or HTTPS</li>
                    <li><strong>Alternative:</strong> Use Full Register to manually choose location</li>
                </ul>
            </div>

            <div style="margin-top: 30px;">
                <button id="btn-retry-location" class="action-btn">üîÑ Try Again</button>
                <a href="@Url.Action("FullRegister", "Pilot")" class="action-btn secondary">üìù Use Full Register</a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="~/lib/leaflet/leaflet.css" />
    <script src="~/lib/leaflet/leaflet.js"></script>
    <script src="~/js/pilot/quick-register.js"></script>
}
